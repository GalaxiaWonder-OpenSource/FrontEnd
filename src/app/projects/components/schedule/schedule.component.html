<div class="schedule-container" *ngIf="!loading(); else loadingTemplate">
  <ng-container *ngIf="milestones().length > 0; else emptyTemplate">
    <mat-card *ngFor="let milestone of milestones()" class="milestone-card">
      <mat-card-header>
        <mat-card-title>{{ milestone.name }}</mat-card-title>
        <mat-card-subtitle>
          {{ milestone.startingDate | date: 'mediumDate' }} â†’
          {{ milestone.endingDate | date: 'mediumDate' }}
        </mat-card-subtitle>
        <button mat-icon-button color="warn" (click)="deleteMilestone(milestone.id!)">
          <mat-icon>delete</mat-icon>
        </button>
      </mat-card-header>

      <mat-card-content>
        <p>{{ milestone.description }}</p>

        <mat-divider class="task-divider"></mat-divider>
        <h4 class="task-heading">Tareas asignadas:</h4>

        <div *ngIf="tasks()[milestone.id!]?.length > 0; else noTasksTemplate">
          <mat-list>
            <mat-list-item *ngFor="let task of tasks()[milestone.id!]">
              <div class="task-item">
                <span class="task-name">{{ task.name }}</span>
                <span class="task-status">{{ task.status }}</span>
                <span class="task-dates">
                  {{ task.startingDate | date: 'shortDate' }} â†’
                  {{ task.dueDate | date: 'shortDate' }}
                </span>
                <button mat-icon-button color="warn" (click)="deleteTask(task.id!)">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </mat-list-item>
          </mat-list>
        </div>
        <ng-template #noTasksTemplate>
          <p class="no-task-msg">Este hito aÃºn no tiene tareas asignadas ðŸ’¤</p>
        </ng-template>
      </mat-card-content>
    </mat-card>
  </ng-container>
</div>

<ng-template #loadingTemplate>
  <div class="loading-box">
    <mat-spinner></mat-spinner>
    <p>Cargando hitos y tareas...</p>
  </div>
</ng-template>

<ng-template #emptyTemplate>
  <div class="empty-msg">
    <p>No se encontraron hitos registrados para este proyecto ðŸ™ˆ</p>
  </div>
</ng-template>
